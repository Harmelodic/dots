#!/bin/bash

# Runs the update/upgrade commands on package managers & tools, then outputs the current/new versions

# OS-specific
if [[ "$(uname)" =~ "Darwin" ]]; then
    echo "=> Upgrading macOS software..."

    # macOS uses brew
    type brew > /dev/null
    if [ $? -eq 0 ]; then
        echo -e "\n-> Updating brew"
        brew update
        brew -v
        brew upgrade
        brew list
        brew upgrade --cask
        brew list --cask
    fi

    # On macOS, gcloud manages itself
    # On Linux, gcloud is managed through a package manager
    type gcloud > /dev/null
    if [ $? -eq 0 ]; then
        echo -e "\n-> Updating gcloud"
        gcloud components update --quiet
        gcloud version | head -1
    fi
elif [[ "$(uname -a)" =~ "MANJARO" ]]; then
    echo "=> Upgrading Manjaro software..."
    sudo pacman -Syu
elif [[ "$(uname -a)" =~ "Ubuntu" ]]; then
    echo "=> Upgrading Ubuntu software..."
    sudo apt update
    sudo apt upgrade
    snap refresh
else
    echo -e "\nNo OS Specific updates to install for $(uname)"
fi

# OS-agnostic
echo "=> Upgrading OS-agnostic software..."


type npm > /dev/null
if [ $? -eq 0 ]; then
    echo -e "\n-> Updating npm"
    npm up -g
    npm ls -g --depth=0
fi

type rustup > /dev/null
if [ $? -eq 0 ]; then
    echo -e "\n-> Updating Rust"
    rustup update
    rustup -V
    rustc -V
fi

type "mise" > /dev/null
if [ $? -eq 0 ]; then
    echo -e "\n-> Updating mise-en-place"
    mise upgrade update
    mise self-update
    mise version
fi

echo -e "\n-> Updating dots"
dots upgrade
